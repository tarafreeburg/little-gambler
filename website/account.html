<!DOCTYPE html>
<html>

<head>
    <title>4BET - Bets</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="account.html">Bets</a></li>
    </ul>
    <h1>List of Bets</h1>
    <div id="bets-container">Loading bets...</div>

    <script>
        async function fetchBets() {
            try {
                const response = await fetch('http://localhost:3000/bets-data');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const bets = await response.json();
                displayBets(bets);
            } catch (error) {
                console.error("Error fetching bets:", error);
                document.getElementById('bets-container').innerHTML = 'Error loading bets.';
            }
        }

        function displayBets(bets) {
            const container = document.getElementById('bets-container');
            if (bets.length === 0) {
                container.innerHTML = 'No bets available.';
                return;
            }

            const betsHTML = bets.map(bet => `
                    <div>
                        <hr>
                        <p>${bet.homeTeam} (H) vs ${bet.awayTeam} (A) </p>
                        <p>$${bet.betAmount} on ${bet.value} @ x${bet.odd} to win $${bet.potentialWinnings}</p>
                        <button onclick="checkGameResult(${bet.fixtureId})">Check Result</button>
                    </div>
                `).join('');

            container.innerHTML = betsHTML;
        }

        async function checkGameResult(fixtureId) {
            try {
                const response = await fetch(`https://api-football-v1.p.rapidapi.com/v3/fixtures?id=${fixtureId}`, {
                    method: 'GET',
                    headers: {
                        'x-rapidapi-key': '921908905cmshac2cc1ffdff44bbp18a0d4jsnc0818ea7d38f',
                        'x-rapidapi-host': 'api-football-v1.p.rapidapi.com'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const resultData = await response.json();
                const matchDetails = resultData.response[0];

                if (!matchDetails) {
                    alert('No match details available for this fixture.');
                    return;
                }

                const matchStatus = matchDetails.fixture.status.long;
                const homeScore = matchDetails.score.fulltime.home;
                const awayScore = matchDetails.score.fulltime.away;

                let message = `Match Status: ${matchStatus}`;

                if (matchStatus !== "Not Started") {
                    message += `\nScore: ${matchDetails.teams.home.name} ${homeScore} - ${matchDetails.teams.away.name} ${awayScore}`;
                }

                alert(message);
            } catch (error) {
                console.error("Error fetching game result:", error);
                alert('Error fetching match result.');
            }
        }

        fetchBets();
    </script>
</body>

</html>